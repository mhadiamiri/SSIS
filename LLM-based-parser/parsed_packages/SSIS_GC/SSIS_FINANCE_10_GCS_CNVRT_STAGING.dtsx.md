```markdown
## 1. Input Connection Analysis

| Connection Manager Name   | Connection Type | Connection String Details  | Purpose within Package  | Security Requirements | Parameters/Variables | Source Part |
|---------------------------|-----------------|---------------------------|--------------------------|-----------------------|-----------------------|-------------|
| GC_STAGING_CONVERTED_ARCHIVE           | OLE DB          | Server: [Inferred], Database: [Inferred] | Destination for staging data | SQL Server Auth likely | None            | Part 1, 2, 3 |
| GC_SOURCE           | OLE DB          | Server: [Inferred], Database: [Inferred] | Source for SAP data | SQL Server Auth likely | None            | Part 1, 2, 3 |

## 2. Package Dependencies

| Dependent Package Name   | Package Full Path | Parent-Child Relationship  | Execution Conditions/Constraints  | Notes                               | Source Part |
|--------------------------|-------------------|------------------------------|-----------------------------------|-------------------------------------|-------------|
| None Found |                     |                                  |                                     | No dependent SSIS packages tasks found   | Part 1, 2, 3|

## 3. Package Flow Analysis

*   **Activities in Execution Order:**

    1.  Expression Task (EXPRESSIONT- FINANCE Stage 10 - Start Task - ProcessDataFlowNode)
    2.  Sequence Container (SEQC-10\_1\_S\_GC\_ACCOUNTING\_DOC\_LINE\_ITEM)
    3.  Sequence Container (SEQC-10\_2\_S\_GC\_FUNCTIONAL\_AREA)
    4.  Sequence Container (SEQC-10\_3\_GC\_PAYMNT\_METHD\_SUPLMNT\_TXT)
    5.  Sequence Container (SEQC-10\_4\_GC\_SPECIAL\_GL\_TRANS\_TYPE\_TEXT)
    6.  Sequence Container (SEQC-10\_5\_S\_GC\_DOCUMENT\_TYPE)
    7.  Sequence Container (SEQC-10\_6\_S\_GC\_BUSINESS\_TRANSACTION\_TYPE)
    8.  Sequence Container (SEQC-10\_7\_S\_GC\_FUNDS\_RESERVATION\_DOCUMENT)
    9.  Sequence Container (SEQC-10\_8\_S\_GC\_POSTING\_TYPE\_EN)

#### DFT-S_GC_ACCOUNTING_DOCUMENT

*   **Source:** OLE DB Source (OLEDB\_SRC-BKPF\_\&\_ZOAT\_Tables) extracts data from `BKPF` and related ZOAT tables.
*   **Transformations:**
    *   `Derived Column`: Creates new columns `RGI_RUN_DT`, `TRANSACTION_TYPE_CD` by applying expressions to transformation input columns.
*   **Destinations:**
    *   `OLEDB_DEST-S_GC_ACCOUNTING_DOCUMENT` saves successfully mapped rows to `dbo.S_GC_ACCOUNTING_DOCUMENT`.

#### DFT-S_GC_ACCOUNTING_DOC_LINE_ITEM

*   **Source:** OLE DB Source (OLEDB\_SRC-BSEG\_\&\_ZOAT\_Tables) extracts data from `BSEG` and related ZOAT tables.
*   **Destinations:**
    *   `OLEDB_DEST-S_GC_ACCOUNTING_DOC_LINE_ITEM` saves successfully mapped rows to `dbo.S_GC_ACCOUNTING_DOC_LINE_ITEM`.

#### DFT-S_GC_FUNCTIONAL_AREA

*   **Source:** OLE DB Source (OLEDB\_SRC-TFKBT\_\&\_ZOAT\_FKBER\_MAP) extracts data from `TFKBT` and related `ZOAT_FKBER_MAP` tables.
*   **Destinations:**
    *   `OLEDB_DEST-S_GC_FUNCTIONAL_AREA` saves successfully mapped rows to `dbo.S_GC_FUNCTIONAL_AREA`.

#### DFT-S_GC_FUND_TO_CENTRAL_ACCNT_XREF

*   **Source:** OLE DB Source (OLEDB\_SRC-ZZRGICAC) extracts data from `ZZRGICAC` table.
*   **Transformations:**
    *   `Derived Column`: Creates new column `FUND_NBR` by applying expressions to transformation input column `FUND_NBR_`.
*   **Destinations:**
    *   `OLEDB_DEST-S_GC_FUND_TO_CENTRAL_ACCNT_XREF` saves successfully mapped rows to `dbo.S_GC_FUND_TO_CENTRAL_ACCNT_XREF`.

#### DFT-S_GC_FUNDED_PROGRAM

*   **Source:** OLE DB Source (OLEDB\_SRC-FMMEASURE\_\&\_FMMEASURET) extracts data from `FMMEASURE` and `FMMEASURET` tables.
*   **Destinations:**
    *   `OLEDB_DEST-S_GC_FUNDED_PROGRAM` saves successfully mapped rows to `dbo.S_GC_FUNDED_PROGRAM`.

#### DFT-S_GC_FUNDS_RESERVATION_ITEM

*   **Source:** OLE DB Source (OLEDB\_SRC-KBLP\_\&\_ZOAT\_Tables) extracts data from `KBLK` table.
*   **Destinations:**
    *   `OLEDB_DEST-S_GC_FUNDS_RESERVATION_ITEM` saves successfully mapped rows to `dbo.S_GC_FUNDS_RESERVATION_ITEM`.

#### DFT-S_GC_GL_ACCOUNT

*   **Source:** OLE DB Source (OLEDB\_SRC-SKA1\_\&\_SKAT) extracts data from `SKA1` and `SKAT` tables.
*   **Destinations:**
    *   `OLEDB_DEST-S_GC_GL_ACCOUNT` saves successfully mapped rows to `dbo.S_GC_GL_ACCOUNT`.

#### DFT-S_GC_PAYMENT_BLOCKING_REASON

*   **Source:** OLE DB Source (OLEDB\_SRC-T008\_\&\_T008T) extracts data from `T008` and `T008T` tables.
*   **Destinations:**
    *   `OLEDB_DEST-S_GC_PAYMENT_BLOCKING_REASON` saves successfully mapped rows to `dbo.S_GC_PAYMENT_BLOCKING_REASON`.

#### DFT-S_GC_PAYMENT_METHOD

*   **Source:** OLE DB Source (OLEDB\_SRC-t042z\_\&\_BI\_Conformed\_dbo\_BI\_COUNTRY\_CD\_UPDATE) extracts data from `t042z` table.
*   **Destinations:**
    *   `OLEDB_DEST-S_GC_PAYMENT_METHOD` saves successfully mapped rows to `dbo.S_GC_PAYMENT_METHOD`.

#### DFT-S_GC_TRANSACTION_TYPE

*   **Source:** OLE DB Source (OLEDB\_SRC-T856\_\&\_T856T) extracts data from `T856` and `T856T` tables.
    * Derived Column: creates new columns FR_DESCR and EN_DESCR
*   **Destinations:**
    *   `OLEDB_DEST-S_GC_TRANSACTION_TYPE` saves successfully mapped rows to `dbo.S_GC_TRANSACTION_TYPE`.

#### DFT-S_GC_TRANSACTION_TYPE_GROUP

*   **Source:** OLE DB Source (OLEDB\_SRC-T856X\_\&\_T856Y) extracts data from `T856X` and `T856Y` tables.
*   **Destinations:**
    *   `OLEDB_DEST-S_GC_TRANSACTION_TYPE_GROUP` saves successfully mapped rows to `dbo.S_GC_TRANSACTION_TYPE_GROUP`.

#### DFT-S_GC_COMMITMENT_ITEM_KEY_XREF

*   **Source:** OLE DB Source (OLEDB\_SRC-FMPOSIT\_\&\_ZOAT\_FIPEX\_MAP) extracts data from `FMPOSIT` and `ZOAT_FIPEX_MAP` tables.
*   **Destinations:**
    *   `OLEDB_DEST-S_GC_COMMITMENT_ITEM_KEY_XREF` saves successfully mapped rows to `dbo.S_GC_COMMITMENT_ITEM_KEY_XREF`.

## 4. Code Extraction

```sql
-- From OLEDB_SRC-BKPF_&_ZOAT_Tables
SELECT
RTRIM(BELNR) as ACCOUNTING_DOCUMENT_NBR,
RTRIM(GJAHR) as FY,
RTRIM(ISNULL(T2.FAS_BLART, T1.BLART)) as DOCUMENT_TYPE_CD,
--TO_CHAR(BLDAT ,'YYYY-MM-DD')) as DOCUMENT_DT,
convert(char(10),BLDAT,120) as DOCUMENT_DT,
convert(char(10),BUDAT,120) as POSTING_DT,
--TO_CHAR(BUDAT,'YYYY-MM-DD')) as POSTING_DT,
MONAT as FISCAL_PERIOD_NBR,
--TO_CHAR(CPUDT,'YYYY-MM-DD')) as ENTRY_DT,
convert(char(10),CPUDT,120) as ENTRY_DT,
--TO_DT(TO_CHAR(CPUTM),'HH24:MI:SS')) as ENTRY_TIME,
RTRIM(convert(char,CPUTM,108)) as ENTRY_TIME,

--TO_CHAR(AEDAT,'YYYY-MM-DD')) as LAST_DOCUMENT_CHANGE_DT,
convert(char(10),AEDAT,120) as LAST_DOCUMENT_CHANGE_DT,
--TO_CHAR(UPDDT,'YYYY-MM-DD')) as LAST_DOCUMENT_UPDATE_DT,
convert(char(10),UPDDT,120) as LAST_DOCUMENT_UPDATE_DT,
--TO_CHAR(WWERT,'YYYY-MM-DD')) as CURRENCY_EXCHANGE_RATE_DT,
convert(char(10),WWERT,120) as CURRENCY_EXCHANGE_RATE_DT,

RTRIM(ISNULL(T3.FAS_USNAM,T1.USNAM)) as LAST_UPDATE_USERID,
--substring(TCODE,1,4)) as TRANSACTION_TYPE_CD,
--Kazim, 2022-02-18, commented above and added follwoing for SSIS
RTRIM(TCODE) as TRANSACTION_TYPE_CD_,
RTRIM(XBLNR) as REFERENCE_DOCUMENT_NBR,
RTRIM(BVORG) as CROSS_COMPANY_TRANSACTION_NUM,
RTRIM(DBBLG) as RECURRING_ENTRY_DOCUMENT_NUM,
RTRIM(STBLG) as REVERSING_DOCUMENT_NBR,
RTRIM(STJAH) as REVERSING_DOC_FY,
CASE
   WHEN BKTXT='' or BKTXT=' ' then null
   ELSE ltrim(rtrim(BKTXT))
END as DOCUMENT_HEADER_TEXT,
RTRIM(WAERS) as CURRENCY_CD,
RTRIM(KURSF) as CURRENCY_EXCHANGE_RATE,
CASE
    WHEN BSTAT=' ' or BSTAT='' then null
    ELSE RTRIM(BSTAT)
END as DOCUMENT_STATUS_CD,
RTRIM(XNETB) as DOCUMENT_POSTED_NET_IND,
RTRIM(FRATH) as UNPLANNED_DELIVERY_COST,
RTRIM(XRUEB) as POSTED_PREVIOUS_PERIOD_IND,
RTRIM(GLVOR) as FI_SL_BUSINESS_ACTIVITY_CD,
RTRIM(GRPID) as BATCH_INPUT_SESSION_NM,
RTRIM(IBLAR) as INTERNAL_DOCUMENT_TYPE_CD,
RTRIM(AWTYP) as REFERENCE_PROCEDURE_NM,
RTRIM(AWKEY) as OBJECT_KEY,
RTRIM(HWAER) as LOCAL_CURRENCY_CD,
RTRIM(XSTOV) as DOC_INDGED_FOR_REVRSL_IND,
--TO_CHAR(STODT,'YYYY-MM-DD')) as PLANNED_REVERSAL_DT,
convert(char(10),STODT,120) as PLANNED_REVERSAL_DT,

RTRIM(XMWST) as AUTO_TAX_CALCULATION_IND,
RTRIM(XSNET) as GL_AMTS_EXCLUDES_TAX_IND,
RTRIM(LOTKZ) as FUNDS_RESERVATION_LOT_NUM,
RTRIM(STGRD) as REVERSAL_REASON_CD,
RTRIM(PPNAM) as PARKED_BY_USERID,
RTRIM(ZZBATCHNO) as RGI_BATCH_NBR,
RTRIM(ZSOURCE) as RGI_SOURCE_CD,
--CONVERT(date,ZRUNDATE)) as RGI_RUN_DT,
RTRIM(substring(CONVERT(char,ZRUNDATE),1,11)) as RGI_RUN_DT_,
RTRIM(ZSTATUS) as RGI_STATUS_CD,
--TO_CHAR(PSOBT,'YYYY-MM-DD')) as PSO_POSTING_DT,
convert(char(10),PSOBT,120) as PSO_POSTING_DT,
RTRIM(PSOZL) as PSO_ACTUAL_POSTING_DT,
--TO_CHAR(PSODT ,'YYYY-MM-DD')) as PSO_LAST_UPDATE_DT,
convert(char(10),PSODT ,120) as PSO_LAST_UPDATE_DT,
--TO_DT(TO_CHAR(PSOTM) ,'HH24:MI:SS')) as PSO_LAST_UPDATE_TIME,
RTRIM(convert(char,PSOTM,108)) as PSO_LAST_UPDATE_TIME,

CONVERT(date,getdate()) as UPDATE_DT,

getdate() as ETL_CREA_DT,
getdate() as ETL_UPDT_DT,
'GCS' as SOURCE_ID

FROM   "BKPF" T1

left join ZOAT_BLART_MAP  T2
on T1.BLART= T2.GCS_BLART

left join ZOAT_USNAM_MAP  T3
on T1.USNAM= T3.GCS_USNAM

WHERE T1.GJAHR <= 2017
```

```sql
-- From ESQLT- Truncate Staging Tables_In_SEQC-10_1_S_GC_ACCOUNTING_DOC_LINE_ITEM
TRUNCATE TABLE dbo.S_GC_ACCOUNTING_DOC_LINE_ITEM;

TRUNCATE TABLE dbo.S_GC_ACCOUNTING_DOCUMENT;
```

```sql
-- From OLEDB_SRC-BSEG_&_ZOAT_Tables
SELECT 
  RTRIM(BELNR) AS ACCOUNTING_DOCUMENT_NBR,
  RTRIM(GJAHR) AS FY ,
  RTRIM(BUZEI) AS ACCOUNTING_DOCUMENT_ITEM_NUM,
  convert(date,AUGDT) AS CLEARING_DT,
  convert(date,AUGCP) AS CLEARING_ENTRY_DT,
  RTRIM(AUGBL) AS CLEARING_DOCUMENT_NBR,
  RTRIM(BSCHL) AS POSTING_TYPE_KEY,
  RTRIM(KOART) AS ACCOUNT_TYPE_CD,
--UMSKZ) AS SPECIAL_GL_TYPE_CD,
  CASE
  WHEN UMSKZ = ' ' then null
  ELSE RTRIM(UMSKZ)
  END  AS SPECIAL_GL_TYPE_CD,

  RTRIM(UMSKS) AS SPECIAL_GL_TRANSCTN_TYPE_CD,
  RTRIM(ZUMSK) AS TARGET_SPECIAL_GL_TYPE_CD,
  RTRIM(SHKZG) AS DEBIT_CREDIT_CD,
  RTRIM(MWSKZ) AS TAX_CD,
  RTRIM(QSSKZ) AS WITHHOLDING_TAX_CD,
  DMBTR AS LOCAL_CURRENCY_AMT,
 WRBTR AS  DOCUMENT_CURRENCY_AMT,
 KZBTR AS  ORIGINAL_REDUCTION_AMT,
 PSWBT AS  GL_UPDATE_AMT,
 RTRIM(PSWSL) AS  GL_AMT_CURRENCY_CD,
 TXBHW AS  ORGNL_LOCL_CURNCY_TAX_BASD_AMT,
 TXBFW AS  ORGNL_DOC_CURNCY_TAX_BASE_AMT,
 MWSTS AS  LOCAL_CURRENCY_TAX_AMT,
 WMWST AS  DOCUMENT_CURRENCY_TAX_AMT,
 HWBAS AS  LOCAL_CURRENCY_TAX_BASE_AMT,
 FWBAS AS  DOCUMENT_CURNCY_TAX_BASE_AMT,
  RTRIM(MWART) AS TAX_TYPE_CD,
  RTRIM(ZUONR) AS ALLOCATION_REFERENCE_NBR,
--  RTRIM(SGTXT) AS LINE_ITEM_TEXT,
  CASE
  WHEN SGTXT = ' ' or SGTXT='' then null
  --ELSE ltrim(rtrim(SGTXT,' '),' ')
  ELSE ltrim(rtrim(SGTXT))
  END  AS LINE_ITEM_TEXT,

  RTRIM(BEWAR) AS TRANSACTION_TYPE_CD,
  RTRIM(ALTKT) AS GL_ACCOUNT_GROUP_NBR,
  RTRIM(VORGN) AS GL_TRANSACTION_TYPE_CD,
  RTRIM(FKONT) AS FINANCIAL_BUDGET_ITEM_NBR,
  RTRIM(ISNULL(T3.FAS_KOSTL, T1.KOSTL)) AS COST_CENTRE_NBR,
 -- AUFNR AS ORDER_NBR,
  CASE
  WHEN AUFNR = ' ' then null
  ELSE RTRIM(AUFNR)
  END  AS ORDER_NBR,

  RTRIM(ANLN1) AS MAIN_ASSET_NBR,
  RTRIM(ANLN2) AS SUB_ASSET_NBR,
  RTRIM(ANBWA) AS  ASSET_TRANSACTION_TYPE_CD,
  convert(date,BZDAT) AS  ASSET_VALUE_DT,
  RTRIM(XSKST) AS STAT_POSTNG_2_COST_CENTR_IND,
  RTRIM(XSAUF) AS STAT_POSTING_TO_ORDER_IND,
  RTRIM(XSPRO) AS STAT_POSTING_PROJECT_IND,
  RTRIM(XSERG) AS STAT_POSTNG_2_PROFL_ANLYS_IND,
  RTRIM(XOPVW) AS OPEN_ITEM_MANAGEMENT_IND,
  RTRIM(XZAHL) AS PAYMENT_TRANSACTION_IND,
  RTRIM(HKONT) AS GL_ACCOUNT_NBR,
--  RTRIM(KUNNR) AS CUSTOMER_NBR,
  CASE
  WHEN KUNNR = ' ' then null
  ELSE RTRIM(KUNNR)
  END  AS CUSTOMER_NBR,

 -- LIFNR) AS VENDOR_NBR,
  CASE
  WHEN rtrim(T1.LIFNR) = '' then null
  WHEN T6.LIFNR IS NOT NULL then RTRIM(T6.LIFNR)
  ELSE RTRIM(T1.LIFNR)
  END  AS VENDOR_NBR,

  RTRIM(XBILK) AS BALANCE_SHEET_ACCOUNT_IND,
  RTRIM(GVTYP) AS PL_ACCOUNT_TYPE_CD,
  RTRIM(HZUON) AS SPECIAL_GL_ALLOCATION_NBR,
  RTRIM(REBZT) AS FOLLOWING_DOCUMENT_TYPE_CD,
  RTRIM(convert(char(10), ZFBDT, 120)) AS BASELINE_PAYMENT_DT,
  --to_char(ZFBDT,'yyyy-mm-dd')) AS BASELINE_PAYMENT_DT,
  RTRIM(ISNULL(T4.FAS_ZLSCH,T1.ZLSCH)) AS PAYMENT_METHOD_CD,
  RTRIM(ZLSPR) AS PAYMENT_BLOCKING_KEY,
 -- EBELN) AS PO_DOCUMENT_NBR,
RTRIM(ISNULL(T8.FAS_EBELN, nullif(T1.EBELN,''))) AS PO_DOCUMENT_NBR,

  RTRIM(EBELP) AS PO_LINE_ITEM_NBR,
  RTRIM(ZEKKN) AS ACCOUNT_ASSIGNMENT_SERIAL_NUM,
  RTRIM(EGBLD) AS DESTINATION_COUNTRY_CD,
  RTRIM(EGLLD) AS SUPPLYING_COUNTRY_CD,
  RTRIM(XHKOM) AS MANUAL_GL_ACCOUNT_IND,
  RTRIM(FIPOS) AS COMMITMENT_ITEM_KEY,
  -- PROJK) AS WBS_NBR,  RTRIM(need to convert that
  RTRIM(isnull(T7.FAS_PSPNR , T1.PROJK)) AS WBS_NBR,   --- should really be called internal wbs nbr
--  RTRIM(XRAGL) AS REVERSE_CLEARING_IND,
  CASE
  WHEN XRAGL = ' ' then null
  ELSE RTRIM(XRAGL)
  END  AS REVERSE_CLEARING_IND,

  RTRIM(UZAWE) AS PAYMENT_METHOD_SUPPLEMENT_CD,

  RTRIM(ISNULL(T9.FAS_FICTR, nullif(T1.FISTL,''))) AS FUND_CENTRE_NBR,

--  RTRIM(GEBER) AS FUND_NBR,
RTRIM(ISNULL(T5.FAS_GEBER, T1.GEBER)) AS FUND_NBR,
RTRIM(T1.GEBER) AS  GCS_FUND_NBR,


--  RTRIM(KBLNR) AS FUNDS_RESERVATION_DOC_NUM,
  CASE
  WHEN KBLNR = ' ' then null
  ELSE RTRIM(KBLNR)
  END  AS FUNDS_RESERVATION_DOC_NUM,

  RTRIM(KBLPOS) AS FUNDS_RESERVATION_ITEM_NUM,
  RTRIM(EMPFB) AS PAYEE_KEY,
  RTRIM(ZZGWAC) AS PROGRAM_ACTIVITY_NBR,
  RTRIM(PERNR) AS PRI_NBR,

CONVERT(date,getdate()) AS UPDATE_DT,

getdate() AS ETL_CREA_DT,
getdate() AS ETL_UPDT_DT
,
'GCS' AS SOURCE_ID
FROM BSEG T1

LEFT JOIN ZOAT_FKBER_MAP T2
	ON T1.FKBER=T2.GCS_FKBER

LEFT JOIN ZOAT_KOSTL_MAP T3
	ON T1.KOSTL=T3.GCS_KOSTL

LEFT JOIN ZOAT_ZLSCH_MAP T4
	ON T1.ZLSCH=T4.GCS_ZLSCH

LEFT JOIN ZOAT_GEBER_MAP T5
	ON T1.GEBER=T5.GCS_GEBER
	and T5.FAS_GEBER <> 'ZZZZ'  -- #78 no longer mapping to zzzz

LEFT JOIN ZOAT_LFB1_MAP T6
	ON T6.ALTKN = T1.lifnr

LEFT JOIN ZOAT_WBS_MAP T7
ON T7.GCS_OBJNR = 'PR' + T1.PROJK

LEFT JOIN ZOAT_PORD_MAP T8
ON T1.EBELN=T8.GCS_EBELN

 -- TFS 982
-- Map the GCS Fund centre numbers
LEFT JOIN ZOAT_FICTR_MAP T9
	ON T1.FISTL = T9.GCS_FICTR
```

```sql
--From ESQLT- Truncate Staging Tables_In_SEQC-10_2_S_GC_FUNCTIONAL_AREA
TRUNCATE TABLE
  dbo.S_GC_FUNCTIONAL_AREA;

TRUNCATE TABLE
  dbo.S_GC_FUNDS_RESERVATION_ITEM;

TRUNCATE TABLE
  dbo.S_GC_FUND_TO_CENTRAL_ACCNT_XREF;

TRUNCATE TABLE
  dbo.S_GC_FUNDED_PROGRAM;
```

```sql
--From OLEDB_SRC-BKPF_&_ZOAT_Tables
--USE GC_SOURCE_DB
SELECT
RTRIM(BELNR) as ACCOUNTING_DOCUMENT_NBR,
RTRIM(GJAHR) as FY,
RTRIM(ISNULL(T2.FAS_BLART, T1.BLART)) as DOCUMENT_TYPE_CD,
--TO_CHAR(BLDAT ,'YYYY-MM-DD')) as DOCUMENT_DT,
convert(char(10),BLDAT,120) as DOCUMENT_DT,
convert(char(10),BUDAT,120) as POSTING_DT,
--TO_CHAR(BUDAT,'YYYY-MM-DD')) as POSTING_DT,
MONAT as FISCAL_PERIOD_NBR,
--TO_CHAR(CPUDT,'YYYY-MM-DD')) as ENTRY_DT,
convert(char(10),CPUDT,120) as ENTRY_DT,
--TO_DT(TO_CHAR(CPUTM),'HH24:MI:SS')) as ENTRY_TIME,
RTRIM(convert(char,CPUTM,108)) as ENTRY_TIME,

--TO_CHAR(AEDAT,'YYYY-MM-DD')) as LAST_DOCUMENT_CHANGE_DT,
convert(char(10),AEDAT,120) as LAST_DOCUMENT_CHANGE_DT,
--TO_CHAR(UPDDT,'YYYY-MM-DD')) as LAST_DOCUMENT_UPDATE_DT,
convert(char(10),UPDDT,120) as LAST_DOCUMENT_UPDATE_DT,
--TO_CHAR(WWERT,'YYYY-MM-DD')) as CURRENCY_EXCHANGE_RATE_DT,
convert(char(10),WWERT,120) as CURRENCY_EXCHANGE_RATE_DT,

RTRIM(ISNULL(T3.FAS_USNAM,T1.USNAM)) as LAST_UPDATE_USERID,
--substring(TCODE,1,4)) as TRANSACTION_TYPE_CD,
--Kazim, 2022-02-18, commented above and added follwoing for SSIS
RTRIM(TCODE) as TRANSACTION_TYPE_CD_,
RTRIM(XBLNR) as REFERENCE_DOCUMENT_NBR,
RTRIM(BVORG) as CROSS_COMPANY_TRANSACTION_NUM,
RTRIM(DBBLG) as RECURRING_ENTRY_DOCUMENT_NUM,
RTRIM(STBLG) as REVERSING_DOCUMENT_NBR,
RTRIM(STJAH) as REVERSING_DOC_FY,
CASE
   WHEN BKTXT='' or BKTXT=' ' then null
   ELSE ltrim(rtrim(BKTXT))
END as DOCUMENT_HEADER_TEXT,
RTRIM(WAERS) as CURRENCY_CD,
RTRIM(KURSF) as CURRENCY_EXCHANGE_RATE,
CASE
    WHEN BSTAT=' ' or BSTAT='' then null
    ELSE RTRIM(BSTAT)
END as DOCUMENT_STATUS_CD,
RTRIM(XNETB) as DOCUMENT_POSTED_NET_IND,
RTRIM(FRATH) as UNPLANNED_DELIVERY_COST,
RTRIM(XRUEB) as POSTED_PREVIOUS_PERIOD_IND,
RTRIM(GLVOR) as FI_SL_BUSINESS_ACTIVITY_CD,
RTRIM(GRPID) as BATCH_INPUT_SESSION_NM,
RTRIM(IBLAR) as INTERNAL_DOCUMENT_TYPE_CD,
RTRIM(AWTYP) as REFERENCE_PROCEDURE_NM,
RTRIM(AWKEY) as OBJECT_KEY,
RTRIM(HWAER) as LOCAL_CURRENCY_CD,
RTRIM(XSTOV) as DOC_INDGED_FOR_REVRSL_IND,
--TO_CHAR(STODT,'YYYY-MM-DD')) as PLANNED_REVERSAL_DT,
convert(char(10),STODT,120) as PLANNED_REVERSAL_DT,

RTRIM(XMWST) as AUTO_TAX_CALCULATION_IND,
RTRIM(XSNET) as GL_AMTS_EXCLUDES_TAX_IND,
RTRIM(LOTKZ) as FUNDS_RESERVATION_LOT_NUM,
RTRIM(STGRD) as REVERSAL_REASON_CD,
RTRIM(PPNAM) as PARKED_BY_USERID,
RTRIM(ZZBATCHNO) as RGI_BATCH_NBR,
RTRIM(ZSOURCE) as RGI_SOURCE_CD,
--CONVERT(date,ZRUNDATE)) as RGI_RUN_DT,
RTRIM(substring(CONVERT(char,ZRUNDATE),1,11)) as RGI_RUN_DT_,
RTRIM(ZSTATUS) as RGI_STATUS_CD,
--TO_CHAR(PSOBT,'YYYY-MM-DD')) as PSO_POSTING_DT,
convert(char(10),PSOBT,120) as PSO_POSTING_DT,
RTRIM(PSOZL) as PSO_ACTUAL_POSTING_DT,
--TO_CHAR(PSODT ,'YYYY-MM-DD')) as PSO_LAST_UPDATE_DT,
convert(char(10),PSODT ,120) as PSO_LAST_UPDATE_DT,
--TO_DT(TO_CHAR(PSOTM) ,'HH24:MI:SS')) as PSO_LAST_UPDATE_TIME,
RTRIM(convert(char,PSOTM,108)) as PSO_LAST_UPDATE_TIME,

CONVERT(date,getdate()) as UPDATE_DT,

getdate() as ETL_CREA_DT,
getdate() as ETL_UPDT_DT,
'GCS' as SOURCE_ID

FROM   "BKPF" T1

left join ZOAT_BLART_MAP  T2
on T1.BLART= T2.GCS_BLART

left join ZOAT_USNAM_MAP  T3
on T1.USNAM= T3.GCS_USNAM

WHERE T1.GJAHR <= 2017
```

```sql
-- From OLEDB_SRC-BSEG_&_ZOAT_Tables
SELECT 
  RTRIM(BELNR) AS ACCOUNTING_DOCUMENT_NBR,
  RTRIM(GJAHR) AS FY ,
  RTRIM(BUZEI) AS ACCOUNTING_DOCUMENT_ITEM_NUM,
  convert(date,AUGDT) AS CLEARING_DT,
  convert(date,AUGCP) AS CLEARING_ENTRY_DT,
  RTRIM(AUGBL) AS CLEARING_DOCUMENT_NBR,
  RTRIM(BSCHL) AS POSTING_TYPE_KEY,
  RTRIM(KOART) AS ACCOUNT_TYPE_CD,
--UMSKZ) AS SPECIAL_GL_TYPE_CD,
  CASE
  WHEN UMSKZ = ' ' then null
  ELSE RTRIM(UMSKZ)
  END  AS SPECIAL_GL_TYPE_CD,

  RTRIM(UMSKS) AS SPECIAL_GL_TRANSCTN_TYPE_CD,
  RTRIM(ZUMSK) AS TARGET_SPECIAL_GL_TYPE_CD,
  RTRIM(SHKZG) AS DEBIT_CREDIT_CD,
  RTRIM(MWSKZ) AS TAX_CD,
  RTRIM(QSSKZ) AS WITHHOLDING_TAX_CD,
  DMBTR AS LOCAL_CURRENCY_AMT,
 WRBTR AS  DOCUMENT_CURRENCY_AMT,
 KZBTR AS  ORIGINAL_REDUCTION_AMT,
 PSWBT AS  GL_UPDATE_AMT,
 RTRIM(PSWSL) AS  GL_AMT_CURRENCY_CD,
 TXBHW AS  ORGNL_LOCL_CURNCY_TAX_BASD_AMT,
 TXBFW AS  ORGNL_DOC_CURNCY_TAX_BASE_AMT,
 MWSTS AS  LOCAL_CURRENCY_TAX_AMT,
 WMWST AS  DOCUMENT_CURRENCY_TAX_AMT,
 HWBAS AS  LOCAL_CURRENCY_TAX_BASE_AMT,
 FWBAS AS  DOCUMENT_CURNCY_TAX_BASE_AMT,
  RTRIM(MWART) AS TAX_TYPE_CD,
  RTRIM(ZUONR) AS ALLOCATION_REFERENCE_NBR,
--  RTRIM(SGTXT) AS LINE_ITEM_TEXT,
  CASE
  WHEN SGTXT = ' ' or SGTXT='' then null
  --ELSE ltrim(rtrim(SGTXT,' '),' ')
  ELSE ltrim(rtrim(SGTXT))
  END  AS LINE_ITEM_TEXT,

  RTRIM(BEWAR) AS TRANSACTION_TYPE_CD,
  RTRIM(ALTKT) AS GL_ACCOUNT_GROUP_NBR,
  RTRIM(VORGN) AS GL_TRANSACTION_TYPE_CD,
  RTRIM(FKONT) AS FINANCIAL_BUDGET_ITEM_NBR,
  RTRIM(ISNULL(T3.FAS_KOSTL, T1.KOSTL)) AS COST_CENTRE_NBR,
 -- AUFNR AS ORDER_NBR,
  CASE
  WHEN AUFNR = ' ' then null
  ELSE RTRIM(AUFNR)
  END  AS ORDER_NBR,

  RTRIM(ANLN1) AS MAIN_ASSET_NBR,
  RTRIM(ANLN2) AS SUB_ASSET_NBR,
  RTRIM(ANBWA) AS  ASSET_TRANSACTION_TYPE_CD,
  convert(date,BZDAT) AS  ASSET_VALUE_DT,
  RTRIM(XSKST) AS STAT_POSTNG_2_COST_CENTR_IND,
  RTRIM(XSAUF) AS STAT_POSTING_TO_ORDER_IND,
  RTRIM(XSPRO) AS STAT_POSTING_PROJECT_IND,
  RTRIM(XSERG) AS STAT_POSTNG_2_PROFL_ANLYS_IND,
  RTRIM(XOPVW) AS OPEN_ITEM_MANAGEMENT_IND,
  RTRIM(XZAHL) AS PAYMENT_TRANSACTION_IND,
  RTRIM(HKONT) AS GL_ACCOUNT_NBR,
--  RTRIM(KUNNR) AS CUSTOMER_NBR,
  CASE
  WHEN KUNNR = ' ' then null
  ELSE RTRIM(KUNNR)
  END  AS CUSTOMER_NBR,

 -- LIFNR) AS VENDOR_NBR,
  CASE
  WHEN rtrim(T1.LIFNR) = '' then null
  WHEN T6.LIFNR IS NOT NULL then RTRIM(T6.LIFNR)
  ELSE RTRIM(T1.LIFNR)
  END